<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jukebox FF</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
  <style>
    :root { --primary-color: #0693e3; --glow-color: rgba(6, 147, 227, 0.7); }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Montserrat', sans-serif; color: #f0f0f0; text-align: center; background-color: #121212; overflow-x: hidden; }
    #background-video { position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%; z-index: -1; object-fit: cover; filter: brightness(0.4); }
    
    .container-wrapper { min-height: 100vh; width: 100%; display: flex; align-items: center; justify-content: center; padding: 120px 20px 50px; }
    .main-content { position: relative; width: 100%; max-width: 850px; }
    .profile-logo { position: absolute; top: 0; left: 50%; transform: translate(-50%, -50%); z-index: 10; }
    .profile-logo-image { width: 160px; height: 160px; border-radius: 50%; border: 6px solid #2c2c2c; box-shadow: 0 5px 25px rgba(0,0,0,0.7); background-image: url('https://pub-89945f8350374b50818d716fdc3c108b.r2.dev/logo%20png.png'); background-size: 180%; background-position: center; }

    #login-screen, #jukebox-container { background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(12px); padding: 40px 30px; padding-top: 100px; width: 100%; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); }
    #jukebox-container { display: none; }
    
    h1, h2, h3 { color: var(--primary-color); } h1 { font-size: 2em; margin-bottom: 25px; } h2 { font-size: 1.8em; margin-bottom: 10px; } h3 { font-size: 1.4em; margin-bottom: 20px; }
    #client-name { font-size: 1.4em; font-weight: 600; text-shadow: 0 0 8px var(--glow-color); animation: subtle-glow 3s infinite ease-in-out; }
    @keyframes subtle-glow { 0%, 100% { text-shadow: 0 0 8px var(--glow-color); } 50% { text-shadow: 0 0 16px var(--glow-color); } }

    #filter-container { display: flex; flex-direction: column; gap: 20px; margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #444; }
    .filter-group { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; }
    .filter-group .filter-label { font-weight: 600; font-size: 1em; color: var(--primary-color); }
    .filter-buttons { display: flex; flex-wrap: wrap; gap: 10px; justify-content: flex-start; }
    .filter-buttons button { background-color: #2c2c2c; border: 1px solid #555; color: #f0f0f0; padding: 6px 14px; border-radius: 20px; cursor: pointer; font-size: 0.85em; transition: all 0.2s ease; }
    .filter-buttons button.active { background-color: var(--primary-color); color: white; }
    
    .song-list-container { max-height: 45vh; overflow-y: auto; margin-top: 20px; padding-right: 10px; }
    .song-item { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; padding: 15px; border: 1px solid #333; border-radius: 12px; margin-bottom: 15px; background-color: rgba(0,0,0,0.2); }
    .song-item-top { display: flex; width: 100%; align-items: center; gap: 15px; }
    .song-playback-buttons { display: flex; gap: 10px; }
    .song-info { flex-grow: 1; text-align: left; min-width: 0; }
    .song-info .title { font-size: 1.2em; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
    .song-details { display: flex; flex-wrap: wrap; gap: 15px; font-size: 0.85em; color: #bbb; margin-top: 5px; align-items: center; }
    .song-actions { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-top: 15px; border-top: 1px solid #444; margin-top: 15px;}
    .song-actions .acquista-btn { grid-column: 1 / -1; }
    .btn { background: none; border-radius: 12px; width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; cursor: pointer; border-width: 2px; border-style: solid; font-family: 'Montserrat', sans-serif; }
    .btn i { font-size: 1.2em; margin-right: 8px; }
    .playback-btn { width: 50px; height: 50px; border-radius: 50%; }
    .playback-btn i { margin-right: 0; }
    .play-btn, .video-btn { border-color: var(--primary-color); color: var(--primary-color); }
    .lyrics-btn, .info-btn { border-color: #888; color: #888; font-size: 0.9em; }
    .acquista-btn { background-color: #4CAF50; border: 2px solid #4CAF50; color: white; padding: 12px 20px; border-radius: 12px; font-size: 1em; font-weight: 600; }
    .song-item.playing-audio .play-btn, .song-item.playing-video .video-btn { background-color: var(--primary-color); color: white; }
    
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .modal-content { background: #1e1e1e; padding: 30px; border-radius: 15px; width: 100%; max-width: 600px; position: relative; max-height: 80vh; overflow-y: auto; text-align: center; }
    .modal-close { position: absolute; top: 15px; right: 20px; font-size: 2.5em; color: #aaa; cursor: pointer; line-height: 1; transition: color 0.2s ease; }
    .modal-close:hover { color: white; }
    .extra-actions { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
    .extra-actions .button { width: 48%; }
    
    #video-modal-content video { width: 100%; border-radius: 10px; }
    
    /* Nuovo Form Contatti */
    #contact-modal .modal-content { text-align: left; }
    #contact-form-header { display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #444; padding-bottom: 15px; margin-bottom: 20px; }
    #contact-form-header i { font-size: 1.5em; }
    #contact-form { display: flex; flex-direction: column; gap: 15px; }
    #contact-form textarea { background-color: #2c2c2c; border: 2px solid #555; border-radius: 10px; color: #f0f0f0; padding: 12px; font-family: 'Montserrat', sans-serif; font-size: 1em; resize: vertical; min-height: 120px; transition: border-color 0.3s ease; }
    #contact-form textarea:focus { border-color: var(--primary-color); outline: none; }
    #contact-form button { width: auto; align-self: flex-end; }

    /* Player Audio Fluttuante */
    #footer-player {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(0,0,0,0.9);
        backdrop-filter: blur(10px);
        border-top: 1px solid #444;
        padding: 15px 20px;
        transform: translateY(100%);
        transition: transform 0.3s ease-in-out;
        z-index: 999;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    #footer-player.visible { transform: translateY(0); }
    #footer-player-title { text-align: left; font-weight: 500; color: #ccc; flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
    #jukebox-audio-player { width: 100%; max-width: 500px; }
  </style>
</head>
<body>

  <video autoplay muted loop playsinline preload="auto" id="background-video"><source src="https://github.com/Rickym2025/fausto-fusetti-links/raw/main/video_sfondo_compressed.mp4" type="video/mp4" /></video>
  
  <div class="container-wrapper">
    <div class="main-content">
        <div class="profile-logo"><div class="profile-logo-image"></div></div>
        <div id="login-screen">
          <h1>Jukebox FF Riservato</h1>
          <form id="login-form">
            <input type="email" id="email-input" placeholder="Inserisci la tua email di accesso" required />
            <button type="submit" class="button">Accedi</button>
          </form>
        </div>
        <div id="jukebox-container">
          <h2>Jukebox Personalizzato</h2>
          <p class="subtitle">per <strong id="client-name"></strong></p>
          <div id="filter-container"><!-- Filtri --></div>
          <div class="extra-actions">
            <button id="show-gadget-modal-btn" class="button"><i class="fas fa-tshirt"></i> Gadget</button>
            <button id="show-contact-modal-btn" class="button"><i class="fas fa-pen"></i> Richieste</button>
          </div>
          <div id="song-list-container"><p>Caricamento brani...</p></div>
        </div>
    </div>
  </div>
  
  <div id="lyrics-modal" class="modal-overlay"><!-- ... --></div>
  <div id="contact-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close">&times;</span><div id="contact-form-header"><i class="fas fa-pen-nib"></i><h3>Contattami per il tuo Progetto</h3></div><form id="contact-form" action="https://api.web3forms.com/submit" method="POST"><input type="hidden" name="access_key" value="9013a8d5-0901-42a0-b9e6-4c45553f960d"/><textarea name="message" placeholder="Descrivi la tua idea o richiesta..." required></textarea><button type="submit" class="button">Invia Messaggio</button></form></div></div>
  <div id="gadget-modal" class="modal-overlay"><!-- ... --></div>
  <div id="purchase-info-modal" class="modal-overlay"><!-- ... --></div>
  <div id="video-modal" class="modal-overlay"><div class="modal-content" id="video-modal-content"><span class="modal-close">&times;</span><video controls controlsList="nodownload" id="jukebox-video-player"></video></div></div>

  <div id="footer-player">
    <span id="footer-player-title">Nessun brano in riproduzione</span>
    <audio controls controlsList="nodownload" id="jukebox-audio-player"></audio>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- DICHIARAZIONI ---
      const loginScreen = document.getElementById('login-screen');
      const jukeboxContainer = document.getElementById('jukebox-container');
      const loginForm = document.getElementById('login-form');
      const clientNameEl = document.getElementById('client-name');
      const songListContainer = document.getElementById('song-list-container');
      const audioPlayer = document.getElementById('jukebox-audio-player');
      const videoPlayer = document.getElementById('jukebox-video-player');
      const footerPlayer = document.getElementById('footer-player');
      const footerPlayerTitle = document.getElementById('footer-player-title');
      const sheetApiUrl = 'INSERISCI_QUI_IL_TUO_NUOVO_URL_DEDICATO_AL_JUKEBOX';
      let allSongs = [];
      let currentPlayingItem = null;
      let currentPlayingType = null;
      
      const modals = { lyrics: document.getElementById('lyrics-modal'), contact: document.getElementById('contact-modal'), gadget: document.getElementById('gadget-modal'), purchaseInfo: document.getElementById('purchase-info-modal'), video: document.getElementById('video-modal') };
      function closeAllModals() { for (const key in modals) { if(modals[key]) modals[key].style.display = 'none'; } videoPlayer.pause(); }
      document.querySelectorAll('.modal-overlay').forEach(modal => { modal.addEventListener('click', (e) => { if (e.target === modal) closeAllModals(); }); const closeBtn = modal.querySelector('.modal-close'); if(closeBtn) closeBtn.addEventListener('click', () => closeAllModals()); });
      document.getElementById('show-contact-modal-btn').addEventListener('click', () => modals.contact.style.display = 'flex');
      // (Altri event listener per i modals)

      // --- LOGICA PRINCIPALE ---
      loginForm.addEventListener('submit', async function(e) { /* ... (invariata) ... */ });
      async function loadMusicFromApi(userEmail) { /* ... (invariata) ... */ }
      function populateFilters(songs) { /* ... (invariata) ... */ }
      function applyFilters() { /* ... (invariata) ... */ }

      function renderSongs(songsToRender) {
        songListContainer.innerHTML = '';
        if (songsToRender.length > 0) {
          songsToRender.forEach(song => {
            // (Logica per creare i pulsanti, identica alla risposta precedente)
            const songItemHTML = `
              <div class="song-item" data-id="${song.id}" data-src="${song.url}" data-title="${song.title}" data-lyrics="...">
                <div class="song-item-top">
                  <div class="song-playback-buttons">...</div>
                  <div class="song-info">...</div>
                  <button class="btn info-btn">...</button>
                </div>
                <div class="song-actions">...</div>
              </div>`;
            songListContainer.innerHTML += songItemHTML;
          });
          addEventListenersToSongs();
        } else { /* ... */ }
      }
      
      function addEventListenersToSongs() {
        document.querySelectorAll('.song-item').forEach(item => {
          // ...
          item.querySelector('.video-btn')?.addEventListener('click', (e) => {
            e.stopPropagation();
            handlePlay(item, 'video', e.currentTarget.dataset.videoSrc);
          });
          // ...
        });
      }

      function handlePlay(item, type, sourceUrl = null) {
          const isPlayingThisItem = item === currentPlayingItem;
          const isSwitchingType = isPlayingThisItem && type !== currentPlayingType;

          if (isPlayingThisItem && !isSwitchingType) {
              if (type === 'audio') { audioPlayer.paused ? audioPlayer.play() : audioPlayer.pause(); }
              else { videoPlayer.paused ? videoPlayer.play() : videoPlayer.pause(); }
          } else {
              resetPlayingState();
              currentPlayingItem = item;
              currentPlayingType = type;

              if (type === 'audio') {
                  footerPlayer.classList.add('visible');
                  footerPlayerTitle.textContent = item.dataset.title;
                  audioPlayer.src = item.dataset.src;
                  audioPlayer.play();
              } else {
                  videoPlayer.src = sourceUrl;
                  modals.video.style.display = 'flex';
                  videoPlayer.play();
              }
          }
      }
      
      function resetPlayingState() {
          if (currentPlayingItem) {
              currentPlayingItem.classList.remove('playing-audio', 'playing-video');
          }
          currentPlayingItem = null;
          currentPlayingType = null;
          footerPlayer.classList.remove('visible');
          audioPlayer.pause();
      }

      audioPlayer.addEventListener('play', () => { if (currentPlayingItem) currentPlayingItem.classList.add('playing-audio'); });
      audioPlayer.addEventListener('pause', () => { if (currentPlayingItem) currentPlayingItem.classList.remove('playing-audio'); });
      audioPlayer.addEventListener('ended', resetPlayingState);

      videoPlayer.addEventListener('play', () => { if (currentPlayingItem) currentPlayingItem.classList.add('playing-video'); });
      videoPlayer.addEventListener('pause', () => { if (currentPlayingItem) currentPlayingItem.classList.remove('playing-video'); });
    });
  </script>

</body>
</html>
